let coins = 100;
const REWARD_AMOUNT = 50; // ہر اشتہار پر انعام کی مقدار
const MONETAG_ZONE_ID = '10010275'; // آپ کا Monetag Zone ID
const coinCountElement = document.getElementById('coin-count');
const adButton = document.getElementById('show-ad-button');
const messageElement = document.getElementById('message');

// ----------------------------------------------------
// مرحلہ 1: Monetag SDK کو کوڈ کے ذریعے شامل کریں (ڈائنامک لوڈنگ)
// ----------------------------------------------------
function loadMonetagSDK() {
    const script = document.createElement('script');
    script.src = '//libtl.com/sdk.js';
    script.setAttribute('data-zone', MONETAG_ZONE_ID);
    script.setAttribute('data-sdk', `show_${MONETAG_ZONE_ID}`);
    // سکرپٹ کو HTML میں شامل کریں تاکہ یہ لوڈ ہو جائے
    document.head.appendChild(script);

    // سکرپٹ لوڈ ہونے کے بعد بٹن کو فعال کریں
    script.onload = () => {
        if (window.show_10010275) { // چیک کریں کہ Monetag کا فنکشن موجود ہے
             adButton.disabled = false;
             messageElement.textContent = "Monetag تیار ہے۔ اشتہار دیکھیں اور Coins حاصل کریں۔";
        }
    };
    script.onerror = () => {
         messageElement.textContent = "Monetag SDK لوڈ نہیں ہو سکا۔";
    };
}

// ٹیلی گرام ویب ایپ کو تیار کریں
window.onload = function() {
    if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.ready();
        loadMonetagSDK(); // یہاں Monetag SDK کو لوڈ کریں
    } else {
        messageElement.textContent = "یہ ایپ صرف Telegram کے اندر چل سکتی ہے۔";
    }
};

// Coins کو اپ ڈیٹ کرنے کا فنکشن
function updateCoins(amount) {
    coins += amount;
    coinCountElement.textContent = coins;
    messageElement.textContent = `آپ نے ${amount} Coins حاصل کیے! کل Coins: ${coins}`;
}

// Rewarded Ad دکھانے کا فنکشن
adButton.addEventListener('click', () => {
    // ----------------------------------------------------
    // مرحلہ 2: Monetag Rewarded Ad کو کال کریں
    // ----------------------------------------------------

    if (!window.show_10010275) {
        messageElement.textContent = "Monetag تیار نہیں ہے۔ براہ کرم انتظار کریں۔";
        return;
    }

    adButton.disabled = true; // اشتہار دکھانے کے دوران بٹن کو غیر فعال کریں
    messageElement.textContent = "اشتہار لوڈ ہو رہا ہے...";

    // Rewarded Interstitial/Popup کو کال کرنے کا Monetag کا تجویز کردہ طریقہ
    // یہاں 'pop' کا پیرامیٹر اسے Rewarded Popup بنا دے گا
    window.show_10010275('pop')
        .then(() => {
            // یہ کوڈ تب چلے گا جب صارف نے اشتہار کامیابی سے دیکھ لیا ہو
            updateCoins(REWARD_AMOUNT);
            adButton.disabled = false; // انعام دینے کے بعد بٹن کو دوبارہ فعال کریں
            
            if (window.Telegram && window.Telegram.WebApp) {
                 window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            }
        })
        .catch(e => {
            // یہ کوڈ تب چلے گا جب اشتہار لوڈ نہ ہو سکے یا کوئی ایرر آئے
            console.error("Monetag Ad Error:", e);
            messageElement.textContent = "اشتہار دکھانے میں مسئلہ آیا۔ دوبارہ کوشش کریں";
            adButton.disabled = false; // مسئلہ آنے پر بھی بٹن کو دوبارہ فعال کریں
        });
});